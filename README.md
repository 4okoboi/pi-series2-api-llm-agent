# Отчет о выполнении серии заданий

GITHUB: https://github.com/4okoboi/pi-series2-api-llm-agent

## API для ML-модели sentiment-analysis и ее тестирование
В качестве фреймворка для API был использован FastAPI
Модель, которая доступна по `/infer` - text-classification pipeline, который делает сентиментальный анализ текста

Был добавлен выбор языка. В зависимости от языка (поле language в входном JSON, поддерживается en/ru) выбирается определенная модель

Тесты были реализованы с помощью `fastapi.testclient`, который позволяет не поднимать HTTP сервер для прогона тестов

Чтобы запустить сервис:
1. ```pip install -r requirements.txt```
2. ```uvicorn main:app```

Для прогона тестов:
1. ```pytest```

## AI Агент-планировщик
### ТЗ
Реализовать агента, который позволяет по текстовой команде пользователя добавить событие в iCloud календарь

Агент должен понимать:
1) Дату события (слова "завтра", "послезавтра" и тд)
2) Длительность события
3) Если это онлайн встреча - в поле Location добавлять ссылку на встречу
4) Понимать русский и английский языки

### Реализация 
Для реализации был использован фреймворк langchain

В качестве модели выбрана `gpt-oss-120b` (можно было и легче, но почему-то моя карта не проходила в OpenAI API)

### Пример использования 
1. ```python agent.py```
2. Написать свой запрос: "Завтра встреча для обсуждения AI-агентов в 15:00. Продлится примерно час. Место проведения: McDonalds на Баумана, Казань"
3. В приложении Календарь или в icloud.com/calendar появится данное событие:
![example](https://github.com/4okoboi/pi-series2-api-llm-agent/blob/main/img.png)
   
### Основные метрики для моделей

1. JSON Validity: доля корректно парсящихся ответов.
2. Field Accuracy: точность ключевых полей (title, datetime, duration, location).
3. Datetime Normalization: правильность часового пояса и длительности.
4. URL Extraction: корректность извлечения ссылок.
5. Hallucination Rate: доля выдуманных деталей.
6. Tool Success: успешность вызовов инструментов (создание событий).
7. ICS Validity: корректность созданных ICS-файлов.
8. Latency/Cost: скорость и ресурсозатраты.
9. Robustness: устойчивость к шумным входам.
10. User Feedback: частота исправлений пользователем.



### Ключевые риски и уязвимости


1. ICS-инъекция: необработанные поля могут нарушить структуру файла. 
**Решение**: экранировать по RFC 5545 или использовать библиотеку icalendar. 
2. Ошибки с часовыми поясами: некорректное использование UTC.
**Решение**: конвертировать с astimezone(pytz.UTC) перед записью. 
3. Неверная локализация времени: .replace(tzinfo=...) искажает время.
**Решение**: использовать dateutil.parser.isoparse. 
4. Избыточные права: создание событий без подтверждения.
**Решение**: требовать явное согласие пользователя. 
5. Утечки в логах: вывод персональных данных и ошибок.
**Решение**: маскировать чувствительные поля. 
6. Дублирование событий: отсутствует проверка на повторы.
**Решение**: использовать детерминированный UID.





